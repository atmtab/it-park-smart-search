<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–¢–µ—Å—Ç API - IT Park Smart Search</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fafafa; }
    .test-section h3 { margin-top: 0; color: #333; }
    button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
    button:hover { background: #0056b3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .result { margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 4px; white-space: pre-wrap; font-family: monospace; font-size: 13px; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ –¢–µ—Å—Ç API - IT Park Smart Search</h1>
    
    <div class="test-section">
      <h3>üè• Health Check</h3>
      <button onclick="testHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/health</button>
      <div id="healthResult" class="result"></div>
    </div>
    
    <div class="test-section">
      <h3>üìä –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–π</h3>
      <button onclick="testCompanies()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/companies</button>
      <div id="companiesResult" class="result"></div>
    </div>
    
    <div class="test-section">
      <h3>üìã –ú–∏–Ω–∏-–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–π</h3>
      <button onclick="testCompaniesMini()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/companies-mini</button>
      <div id="companiesMiniResult" class="result"></div>
    </div>
    
    <div class="test-section">
      <h3>üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</h3>
      <button onclick="testSearch()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/search</button>
      <div id="searchResult" class="result"></div>
    </div>
  </div>

  <script>
    async function testHealth() {
      const result = document.getElementById('healthResult');
      result.innerHTML = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
      result.className = 'result info';
      
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        
        result.innerHTML = `‚úÖ Health Check —É—Å–ø–µ—à–µ–Ω!\n\n–°—Ç–∞—Ç—É—Å: ${data.status}\n–°–æ–æ–±—â–µ–Ω–∏–µ: ${data.message}\n–í—Ä–µ–º—è: ${data.timestamp}`;
        result.className = 'result success';
      } catch (error) {
        result.innerHTML = `‚ùå –û—à–∏–±–∫–∞ Health Check: ${error.message}`;
        result.className = 'result error';
      }
    }
    
    async function testCompanies() {
      const result = document.getElementById('companiesResult');
      result.innerHTML = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...';
      result.className = 'result info';
      
      try {
        const response = await fetch('/api/companies');
        const data = await response.json();
        
        result.innerHTML = `‚úÖ –î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\n\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–∞–Ω–∏–π: ${data.length}`;
        result.className = 'result success';
      } catch (error) {
        result.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`;
        result.className = 'result error';
      }
    }
    
    async function testCompaniesMini() {
      const result = document.getElementById('companiesMiniResult');
      result.innerHTML = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...';
      result.className = 'result info';
      
      try {
        const response = await fetch('/api/companies-mini');
        const data = await response.json();
        
        result.innerHTML = `‚úÖ –ú–∏–Ω–∏-–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\n\n–ö–æ–º–ø–∞–Ω–∏–π: ${data.companies.length}\n–°–µ–∫—Ç–æ—Ä–æ–≤: ${Object.keys(data.sector_mapping).length}\n–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö: ${Object.keys(data.focal_mapping).length}`;
        result.className = 'result success';
      } catch (error) {
        result.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∏–Ω–∏-–¥–∞–Ω–Ω—ã—Ö: ${error.message}`;
        result.className = 'result error';
      }
    }
    
    async function testSearch() {
      const result = document.getElementById('searchResult');
      result.innerHTML = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...';
      result.className = 'result info';
      
      try {
        const response = await fetch('/api/search', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            query: 'erp —Å–∏—Å—Ç–µ–º—ã',
            mode: 'ai'
          })
        });
        
        const data = await response.json();
        
        result.innerHTML = `‚úÖ –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω!\n\n–°–æ–æ–±—â–µ–Ω–∏–µ: ${data.message}\n–í—Ä–µ–º—è: ${data.timestamp}`;
        result.className = 'result success';
      } catch (error) {
        result.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}`;
        result.className = 'result error';
      }
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º health check –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.onload = function() {
      testHealth();
    };
  </script>
</body>
</html>
